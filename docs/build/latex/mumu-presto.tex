%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
\edef\sphinxdqmaybe{\ifdefined\DeclareUnicodeCharacterAsOptional\string"\fi}
  \DeclareUnicodeCharacter{\sphinxdqmaybe00A0}{\nobreakspace}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2500}{\sphinxunichar{2500}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2502}{\sphinxunichar{2502}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2514}{\sphinxunichar{2514}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe251C}{\sphinxunichar{251C}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}
\usepackage{times}
\usepackage[Sonny]{fncychap}
\ChNameVar{\Large\normalfont\sffamily}
\ChTitleVar{\Large\normalfont\sffamily}
\usepackage{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}

% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\figurename}{图 }}
\makeatletter
\def\fnum@figure{\figurename\thefigure{}}
\makeatother
\addto\captionsenglish{\renewcommand{\tablename}{表 }}
\makeatletter
\def\fnum@table{\tablename\thetable{}}
\makeatother
\addto\captionsenglish{\renewcommand{\literalblockname}{列表}}

\addto\captionsenglish{\renewcommand{\literalblockcontinuedname}{续上页}}
\addto\captionsenglish{\renewcommand{\literalblockcontinuesname}{下页继续}}
\addto\captionsenglish{\renewcommand{\sphinxnonalphabeticalgroupname}{Non-alphabetical}}
\addto\captionsenglish{\renewcommand{\sphinxsymbolsname}{符号}}
\addto\captionsenglish{\renewcommand{\sphinxnumbersname}{Numbers}}

\addto\extrasenglish{\def\pageautorefname{页}}

\setcounter{tocdepth}{1}



\title{mumu-presto Documentation}
\date{2019 年 08 月 22 日}
\release{0.0.1}
\author{babymm}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{发布}
\makeindex
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}



\chapter{presto简介}
\label{\detokenize{overview:presto}}\label{\detokenize{overview::doc}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Presto是一个开源的分布式SQL查询引擎，用于针对各种大小（从千兆字节到千兆字节）的数据源运行交互式分析查询。

Presto是从头开始设计和编写的，用于交互式分析，接近商业数据仓库的速度，同时扩展到Facebook等组织的规模。

presto是一款基于内存、基于sql的大数据实时查询(Ad\PYGZhy{}hoc)开源计算框架，由facebook开发。presto使用connector连接不同的数据源，将不同数据源的数据
存储在内存中进行计算，可以跨数据源进行计算。

大数据计算框架主要分为脚本程序和类sql两种方式。脚本程序主要由mapreduce、pig、crunch、sparkRDD、cascading、tez等执行框架。类sql的实时计算框
架包含hive、sparkSQL、impala。其中sparkSQL也是基于内存的计算框架。
\end{sphinxVerbatim}

\sphinxstylestrong{脚本分析组件:}


\begin{savenotes}\sphinxattablestart
\centering
\begin{tabulary}{\linewidth}[t]{|T|T|T|T|T|T|T|T|T|}
\hline
\sphinxstyletheadfamily 
Concept
&\sphinxstyletheadfamily 
Apache Hadoop MapReduce
&\sphinxstyletheadfamily 
Apache Crunch
&\sphinxstyletheadfamily 
Apache Pig
&\sphinxstyletheadfamily 
Apache Spark
&\sphinxstartmulticolumn{2}%
\begin{varwidth}[t]{\sphinxcolwidth{2}{9}}
\sphinxstyletheadfamily Cascading
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
&\sphinxstartmulticolumn{2}%
\begin{varwidth}[t]{\sphinxcolwidth{2}{9}}
\sphinxstyletheadfamily Apache Tez
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
\\
\hline
Input Data
&
InputFormat
&
Source
&
LoadFunc
&
InputFormat
&\sphinxstartmulticolumn{4}%
\begin{varwidth}[t]{\sphinxcolwidth{4}{9}}
Tap (Source)     \textbar{}  Tez Input
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
\\
\hline
Output Data
&
OutputFormat
&
Target
&
StoreFunc
&
OutputFormat
&\sphinxstartmulticolumn{4}%
\begin{varwidth}[t]{\sphinxcolwidth{4}{9}}
Tap (Sink)       \textbar{} Tez Output
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
\\
\hline
Data Container
Abstraction
&
N/A
&
PCollection
&
Relation
&
RDD
&\sphinxstartmulticolumn{2}%
\begin{varwidth}[t]{\sphinxcolwidth{2}{9}}
Pipe
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
&\sphinxstartmulticolumn{2}%
\begin{varwidth}[t]{\sphinxcolwidth{2}{9}}
Vertex
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
\\
\hline
Data Format
Serialization
&
Writables
&
POJOs and
PTypes
&
Pig Tuples
and Schemas
&
POJOs and Java/Kryo
Serialization
&\sphinxstartmulticolumn{2}%
\begin{varwidth}[t]{\sphinxcolwidth{2}{9}}
Cascading Tuples
and Schemes
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
&\sphinxstartmulticolumn{2}%
\begin{varwidth}[t]{\sphinxcolwidth{2}{9}}
Events
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
\\
\hline
Data
Transformation
&
Mapper, Reducer,
and Combiner
&
DoFn
&
PigLatin
and UDFs
&
Functions
(Java API)
&\sphinxstartmulticolumn{2}%
\begin{varwidth}[t]{\sphinxcolwidth{2}{9}}
Operations
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
&\sphinxstartmulticolumn{2}%
\begin{varwidth}[t]{\sphinxcolwidth{2}{9}}
Processor
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
\\
\hline
\end{tabulary}
\par
\sphinxattableend\end{savenotes}

\sphinxstylestrong{SQL分析组件:}


\begin{savenotes}\sphinxattablestart
\centering
\begin{tabulary}{\linewidth}[t]{|T|T|T|T|T|}
\hline
\sphinxstyletheadfamily 
Concept
&\sphinxstyletheadfamily 
Apache hive
&\sphinxstyletheadfamily 
presto
&\sphinxstyletheadfamily 
sparkSQL
&\sphinxstyletheadfamily 
impala
\\
\hline
多数据源
&
是
&
是
&
是
&
是
\\
\hline
基于内存
&
否
&
是
&
是
&
否
\\
\hline
查询速度
&
慢
&
极快
&
快
&
快
\\
\hline
支持数据量
&
一般
&
大
&
大
&
大
\\
\hline
\end{tabulary}
\par
\sphinxattableend\end{savenotes}


\bigskip\hrule\bigskip



\section{presto发展}
\label{\detokenize{overview/develop:presto}}\label{\detokenize{overview/develop::doc}}
随着数据量的快速递增，传统数据库已经不能满足大数据量的业务需求，接着出现了hadoop大数据平台，hadoop就是专门来处理大量数据的存储和离线
计算的开源框架。但是hadoop提供的是map-reduce计算框架，这种框架适用于大数据的离线和批量计算，因为该框架考虑的是数据吞吐率而不是计算效
率，所以不能满足大数据快速实时(Ad-hoc)查询。

各大互联网公司和企业也发现map-reduce计算框架在快速查询所表现出来的弊端，各个互联网公司都纷纷进行大数据实时查询的开发，facebook于2012
年开始开发presto，目前产品已经超过facebook1000名雇员开始使用，每天运行超过30000个查询，每日查询数据量在1PB级别。facebook称rpresto比hive
要好上10倍还多，于2013年进行开源发布。


\section{presto特点}
\label{\detokenize{overview/feature:presto}}\label{\detokenize{overview/feature::doc}}
presto是专门为大数据实时查询而设计和开发的产品。由于presto是使用java开发，所以极易学习和使用，并且对于特定的场景进行自定义开发和性能优化。
无论是对多数据源的支持，还是高性能、可拓展、易用性等，presto都是大数据产品中的佼佼者，presto的特性如下所示:


\subsection{多数据源}
\label{\detokenize{overview/feature:id1}}\begin{quote}
\begin{itemize}
\item {} 
Postgresql Connector

\item {} 
Mysql Connector

\item {} 
Cassandra Connector

\item {} 
Hive Connector

\item {} 
Kafka Connector

\item {} 
jmx Connector

\item {} 
Accumulo Connector

\item {} 
Elasticsearch Connector

\item {} 
Kudu Connector

\item {} 
Local File Connector

\item {} 
Memory Connector

\item {} 
MongoDB Connector

\item {} 
Redis Connector

\item {} 
SQL Server Connector

\item {} 
Redshift Connector

\item {} 
Thrift Connector

\item {} 
System Connector

\item {} 
TPCDS Connector

\item {} 
TPCH Connector

\end{itemize}

目前presto可以支持数据源包含上面多种connector数据源。而且可以通过spi接口进行自定义数据源接入开发。
\end{quote}


\subsection{支持sql}
\label{\detokenize{overview/feature:sql}}\begin{quote}

presto可以完全支持ANSI SQL，并提供了一个shell供客户端查询计算。
\end{quote}


\subsection{可拓展}
\label{\detokenize{overview/feature:id2}}\begin{quote}

presto有很好的拓展性，开发人员可以使用spi来编写自己的connector，并且使用sql语句查询和分析自己编写的connector数据源
\end{quote}


\subsection{混合计算}
\label{\detokenize{overview/feature:id3}}\begin{quote}

在数据库中每种类型的数据源都对应这一个特定的connector，用户可以根据业务需求在presto中针对一个特定的connector类型配置一个或者多个catalog，
用户可以混合多个catalog进行join查询和计算。
\end{quote}


\subsection{高性能}
\label{\detokenize{overview/feature:id4}}\begin{quote}

经过facebook测试计算，presto的性能是hive的10被，是sparkSQL的三倍。
\end{quote}


\subsection{流水线}
\label{\detokenize{overview/feature:id5}}\begin{quote}

presto是使用pipeline来进行设计的，查询的时候客户不需要等待所有的结果出来完成之后才能获取到结果，而是计算出来一部分结果之后就反馈给
客户，形成一个流水线操作。
\end{quote}


\section{presto基本概念}
\label{\detokenize{overview/concept:presto}}\label{\detokenize{overview/concept::doc}}

\subsection{presto服务进程}
\label{\detokenize{overview/concept:id1}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
presto服务器进程一共有两种服务器进程：coordinator服务进程和worker服务进程，其中coordinator服务进程主要作用是:接收查询请求、生成查询执行计划、
任务调度和worker管理。而worker服务进程则执行被分解后的查询执行计划:task。
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{presto-coordinator-worker}.jpg}


\subsubsection{coordinator}
\label{\detokenize{overview/concept:coordinator}}\begin{quote}

presto服务器进程部署于集群中的单独节点上，是整个presto集群的管理节点。coordinator服务进程主要作用是接收查询请求，查询语句解析，生成查询执行
计划、stage和task并且对生成的task进行调度。除此之外，还对整个集群的worker节点进行管理。coordinator服务进程是整个集群的master进程，该进程于
worker进程通信从而获取到最新的worker进程信息，又与客户端进程进行通信，获取查询请求。而这些所有功能都是由coordinator进程的RESTFUL服务来实现。
\end{quote}


\subsubsection{worker}
\label{\detokenize{overview/concept:worker}}\begin{quote}

在一个presto集群中存在一个coordinator服务进程和多个worker服务进程，coordinator服务进程是管理节点，而worker进程是工作节点。在每一个worker进程
都有一个worker服务进程，该服务主要进行数据处理和task任务的执行。worker进程每隔固定的时间都会向coordinator服务进程发送心跳，告诉coordinator我
还活着，接受调度。当客户端接受到查询请求的时候，coordinator会从当前存活的节点随机选择worker进程进行task。而worker在执行task的时候又会对数据进
行分片处理，并行进行数据处理。
\end{quote}


\subsection{presto模型}
\label{\detokenize{overview/concept:id2}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
presto可以通过不同的connector访问多种数据源，如hive、kafka、elasticsearch等(详情参照)，该节说明presto是如何访问多种不同类型的数据源，并且对
presto模型和概念进行描述。presto可以通过connector连接一个数据源，可以根据一个connector配置多个catalog，一个catalog可以有多个schema，一个
schema可以有多个table。
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{presto-model}.jpg}


\subsubsection{connector}
\label{\detokenize{overview/concept:connector}}\begin{quote}

presto是通过多种多样的connector来访问不同的数据源的。可以将connector当做presto访问数据源的驱动程序，每一个数据源必须有配套的connector。每种
connector都实现了presto标准的spi接口，因此只要你实现了spi接口，就可以编写一个自定义的connector。

当需要使用某种类型的connector的时候，需要在presto的安装目录下的etc/catalog里面创建配置文件，而且在该配置文件中必须要配置connector.name属性
presto的connector manager需要根据connector.name来查找数据源进行访问。
\end{quote}


\subsubsection{catalog}
\label{\detokenize{overview/concept:catalog}}\begin{quote}

presto的catalog类似于mysql的数据库实例，而shcema类似于数据库。catalog的名称就是在etc/catalog里面添加的配置文件名称，如果配置了一个
postgres.properties,那么catalog就是postgres。
\end{quote}


\subsubsection{schema}
\label{\detokenize{overview/concept:schema}}\begin{quote}

presto的schema类似于数据库名称，一个catalog和schema确定一个表的明确位置信息。当使用presto去查询hive和mysql的时候，你会发现schema是数据库名称。
而当使用postgresql的时候schema是pg的schema。
\end{quote}


\subsubsection{table}
\label{\detokenize{overview/concept:table}}\begin{quote}

presto的table和传统数据库的表定义是一样的。
\end{quote}


\subsection{presto查询执行}
\label{\detokenize{overview/concept:id3}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
presto在执行sql语句的时候，将这些sql解析成对应的查询，并且在分布式集群中执行这些查询。
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{presto-query}.png}


\subsubsection{statement}
\label{\detokenize{overview/concept:statement}}\begin{quote}

statement语句就是指我们输入的sql查询语句。presto支持符合ANSI标准的SQL语句。这种语句由字句(Clause)、表达式(Expression)和断言(Predicate)组成。

presto将语句和查询分开主要是由于查询和语句概念不同，语句是输入的sql语句，而查询是根据语句生成的查询执行计划，进而生成可以执行的查询语，代表
着分布到所有worker节点的实际查询操作。
\end{quote}


\subsubsection{query}
\label{\detokenize{overview/concept:query}}\begin{quote}

presto接收查询语句，生成查询执行计划query。一个查询执行代表这可以在集群中运行的查询，他由运行在worker上的节点和相互关联的阶段stage组成。
一个查询执行由stage、task、driver、operator、和datasource组成，这些组件之间通过内部联系共同组成了一个查询执行，从而得到sql查询结果。
\end{quote}


\subsubsection{stage}
\label{\detokenize{overview/concept:stage}}\begin{quote}

stage即是查询执行阶段，当执行一个sql的时候，presto会把查询分成多个不同阶段的stage，一个stage代表查询执行计划的一部分。通常情况下，stage
之间是树状结构。

每一个查询都有一个root stage，root stage用于聚集其他stage的数据并产生最终结果。stage并不会在集群中实际运行，stage是逻辑
执行计划和建模。

每一个stage(single stage和source stage)都会有输入和输出，都会从上游stage读取数据，然后将结果传递到下游stage。source
stage没有上游stage，single没有下游stage。

\noindent\sphinxincludegraphics{{presto-stage}.jpg}

presto包含四种类型的stage:
\begin{itemize}
\item {} 
Coordinay\_Only

\end{itemize}

这种stage用于执行ddl、dml表结构创建和修改。
\begin{itemize}
\item {} 
Single

\end{itemize}

这种stage聚合子stage结果，并将最终数据返回到客户端程序。
\begin{itemize}
\item {} 
fixed

\end{itemize}

这种stage用于接收子stage产生的数据，并且在集群中对这些数据进行聚合和分组操作。
\begin{itemize}
\item {} 
source

\end{itemize}

这种stage直接接收数据源数据，从数据源读取数据，该阶段也会对sql进行优化，如数据过滤和断言下发。
\end{quote}


\subsubsection{exchange}
\label{\detokenize{overview/concept:exchange}}\begin{quote}

presto是通过exchange来连接stage和stage的。exchage用来完成有上下游关系的stage之间的数据交换。

在presto中有两种类型的exchange，output buffer 和exchange client。生产数据的stage通过output buffer的exchange将数据传递给下游stage。消费数据
的stage通过名为exchange client的exchange获取上游stage的数据。
\end{quote}


\subsubsection{task}
\label{\detokenize{overview/concept:task}}\begin{quote}

stage并不会在presto集群中实际执行，每一个stage都是由多个task组成，task是实际运行在presto的worker节点上。

在presto中一个查询被分解中多个stage阶段，每一个stage阶段又按照业务逻辑分成多个任务，每个任务处理一个或者多个分片，每个分片是由一个driver
程序来实际运行，通过这种分解来并行执行任务。
\end{quote}


\subsubsection{driver}
\label{\detokenize{overview/concept:driver}}\begin{quote}

一个task包含多个driver，每一个driver是对一个split分片的operator操作集合。因此一个driver处理一个split，并且由将结果传递到下一个stage的
task任务中，一个driver拥有一个输入和一个输出。
\end{quote}


\subsubsection{operator}
\label{\detokenize{overview/concept:operator}}\begin{quote}

一个operator是对一个split分片的实际操作，过过滤、加权、转换等。一个operator依次读取split的数据，并产生输出。operator每次读取一个page，
也输出一个page。
\end{quote}


\subsubsection{split}
\label{\detokenize{overview/concept:split}}\begin{quote}

一个split是数据集的子集。当presto执行查询的时候，首先会从coordinator获取一个表所对应的split，然后presto会指定查询计划，选择合适的worker
去执行split。这里通常会用到数据本地化，就是尽量将worker分配在数据存储的地方。
\end{quote}


\subsubsection{page}
\label{\detokenize{overview/concept:page}}\begin{quote}

page是presto数据处理单元最小的单元。一个page对象包含多个block对象，而一个block对象是一个字段的多行数据。多个block横切的一行就是presto
真实的一行数据。一个page最大为1M，最多16*1024行。

\noindent\sphinxincludegraphics{{presto-page}.png}
\end{quote}


\section{presto架构}
\label{\detokenize{overview/architecture:presto}}\label{\detokenize{overview/architecture::doc}}
Presto是一个在一组机器上运行的分布式系统。 完整安装包括协调员和多个工作人员。 查询从客户端（Presto CLI、presto-jdbc）提交给协调器。 协调器解析，
分析和计划查询执行，然后将处理分发给worker工作进程。


\subsection{presto硬件架构}
\label{\detokenize{overview/architecture:id1}}
\noindent\sphinxincludegraphics{{presto-architecture-machine}.png}


\subsection{presto软件架构}
\label{\detokenize{overview/architecture:id2}}
\noindent\sphinxincludegraphics{{presto-architecture-soft}.png}


\section{presto VS hive}
\label{\detokenize{overview/prestovshive:presto-vs-hive}}\label{\detokenize{overview/prestovshive::doc}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Presto是一个开源的分布式SQL查询引擎，用于针对各种大小（从千兆字节到千兆字节）的数据源运行交互式分析查询。
\end{sphinxVerbatim}


\section{presto VS spark}
\label{\detokenize{overview/prestovsspark:presto-vs-spark}}\label{\detokenize{overview/prestovsspark::doc}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Presto是一个开源的分布式SQL查询引擎，用于针对各种大小（从千兆字节到千兆字节）的数据源运行交互式分析查询。
\end{sphinxVerbatim}


\chapter{presto安装部署}
\label{\detokenize{installation:presto}}\label{\detokenize{installation::doc}}
presto目前只能部署在linxu操作系统中，暂时不支持windows操作系统。prsto是使用java来进行编写的，因此linux环境必须先要安装java1.8版本。
presto可以部署在单节点上，也可以部署在集群中。


\section{环境准备}
\label{\detokenize{installation/enviroment:id1}}\label{\detokenize{installation/enviroment::doc}}
presto是java程序开发的项目，所以项目最低依赖于java。


\subsection{java安装}
\label{\detokenize{installation/enviroment:java}}
1、从oracle下载jdk1.8.12+版本的java。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{wget} \PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{download}\PYG{o}{.}\PYG{n}{oracle}\PYG{o}{.}\PYG{n}{com}\PYG{o}{/}\PYG{n}{otn}\PYG{o}{/}\PYG{n}{java}\PYG{o}{/}\PYG{n}{jdk}\PYG{o}{/}\PYG{l+m+mi}{8}\PYG{n}{u221}\PYG{o}{\PYGZhy{}}\PYG{n}{b11}\PYG{o}{/}\PYG{l+m+mi}{230}\PYG{n}{deb18db3e4014bb8e3e8324f81b43}\PYG{o}{/}\PYG{n}{jdk}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{8}\PYG{n}{u221}\PYG{o}{\PYGZhy{}}\PYG{n}{linux}\PYG{o}{\PYGZhy{}}\PYG{n}{x64}\PYG{o}{.}\PYG{n}{tar}\PYG{o}{.}\PYG{n}{gz}
\end{sphinxVerbatim}

2、解压jdk到、/usr/local目录

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{tar} \PYG{o}{\PYGZhy{}}\PYG{n}{xzvf} \PYG{n}{jdk}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{8}\PYG{n}{u221}\PYG{o}{\PYGZhy{}}\PYG{n}{linux}\PYG{o}{\PYGZhy{}}\PYG{n}{x64}\PYG{o}{.}\PYG{n}{tar}\PYG{o}{.}\PYG{n}{gz} \PYG{o}{\PYGZhy{}}\PYG{n}{C} \PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}
\end{sphinxVerbatim}

3、配置JAVA\_HOME和path

\begin{sphinxVerbatim}[commandchars=\\\{\}]
JAVA\PYGZus{}HOME=/usr/local/jdk1.8.0\PYGZus{}221
CLASSPATH=.:\PYGZdl{}JAVA\PYGZus{}HOME/lib.tools.jar
PATH=\PYGZdl{}JAVA\PYGZus{}HOME/bin:\PYGZdl{}PATH
export JAVA\PYGZus{}HOME CLASSPATH PATH
\end{sphinxVerbatim}


\section{源码编译}
\label{\detokenize{installation/compile:id1}}\label{\detokenize{installation/compile::doc}}

\subsection{git安装}
\label{\detokenize{installation/compile:git}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{apt} \PYG{n}{install} \PYG{n}{git}
\end{sphinxVerbatim}


\subsection{maven安装}
\label{\detokenize{installation/compile:maven}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{apt} \PYG{n}{install} \PYG{n}{maven}
\end{sphinxVerbatim}


\subsection{源码下载}
\label{\detokenize{installation/compile:id2}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{git} \PYG{n}{clone} \PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{github}\PYG{o}{.}\PYG{n}{com}\PYG{o}{/}\PYG{n}{prestodb}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{.}\PYG{n}{git}
\end{sphinxVerbatim}


\section{单节点安装}
\label{\detokenize{installation/standardlone:id1}}\label{\detokenize{installation/standardlone::doc}}

\subsection{github下载安装包}
\label{\detokenize{installation/standardlone:github}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{wget} \PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{github}\PYG{o}{.}\PYG{n}{com}\PYG{o}{/}\PYG{n}{prestodb}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{/}\PYG{n}{archive}\PYG{o}{/}\PYG{l+m+mf}{0.217}\PYG{o}{.}\PYG{n}{tar}\PYG{o}{.}\PYG{n}{gz}
\end{sphinxVerbatim}


\subsection{解压安装包}
\label{\detokenize{installation/standardlone:id2}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{tar} \PYG{o}{\PYGZhy{}}\PYG{n}{xzvf} \PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.217}\PYG{o}{.}\PYG{n}{tar}\PYG{o}{.}\PYG{n}{gz} \PYG{o}{\PYGZhy{}}\PYG{n}{C} \PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{presto-dirs}.png}


\subsection{修改config.properties配置}
\label{\detokenize{installation/standardlone:config-properties}}
\noindent\sphinxincludegraphics{{presto-config}.png}
\begin{itemize}
\item {} 
coordinator

是否该服务器作为presto的主节点(coordinator服务)。单机模式需要将该值配置为true。

\item {} 
node-scheduler.include-coordinator

是否启用coordinator进程来进行数据计算。单机模式需要将该值配置为true。

\item {} 
http-server.http.port

presto服务端口

\item {} 
query.max-memory

单个query查询最大内存

\item {} 
query.max-memory-per-node

单个节点最大内存

\item {} 
query.max-total-memory-per-node

单个节点总内存

\item {} 
discovery-server.enabled

是否开启discovery服务，默认discovery服务和coordinator服务绑定在一起。如果coordinator配置为true，那么discovery-server.enabled也需要配置为true。

\item {} 
query.discovery.uri

discovery服务uri地址信息，worker节点通过discovery服务来找到master。

\end{itemize}


\subsection{修改jvm.properties配置}
\label{\detokenize{installation/standardlone:jvm-properties}}
\noindent\sphinxincludegraphics{{presto-jvm}.png}
\begin{itemize}
\item {} 
server

以java服务端进程启动

\item {} 
xmx

jvm最大堆内存，该值需要和query.max-memory-per-node之间有关联，不能够query.max-memory-per-node的值大于jvm最大堆大小。

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{query}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{memory}\PYG{o}{\PYGZhy{}}\PYG{n}{per}\PYG{o}{\PYGZhy{}}\PYG{n}{node} \PYG{o}{\PYGZlt{}} \PYG{n}{xmx}\PYG{o}{*}\PYG{l+m+mf}{0.8}
\PYG{n}{xmx} \PYG{o}{\PYGZgt{}} \PYG{n}{query}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{memory}\PYG{o}{\PYGZhy{}}\PYG{n}{per}\PYG{o}{\PYGZhy{}}\PYG{n}{node}\PYG{o}{/}\PYG{l+m+mf}{0.8}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
xx

UseG1GC使用的是g1的gc收集器进行新生代和老年代gc收集，目前g1是最新性能比较好的gc收集器。

\end{itemize}


\subsection{修改node.properties配置}
\label{\detokenize{installation/standardlone:node-properties}}
\noindent\sphinxincludegraphics{{presto-node}.png}
\begin{itemize}
\item {} 
node.environment

presto集群名称

\item {} 
node.id

presto的worker节点id

\item {} 
node.data-dir

presto的日志目录，该目录无需手动创建，程序会自动创建。

\end{itemize}


\subsection{修改log.properties配置}
\label{\detokenize{installation/standardlone:log-properties}}
\noindent\sphinxincludegraphics{{presto-log}.png}
\begin{itemize}
\item {} 
com.facebook.presto

presto的log日志级别

\end{itemize}


\subsection{presto服务启动}
\label{\detokenize{installation/standardlone:presto}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{.}\PYG{o}{/}\PYG{n}{launcher} \PYG{n}{start}
\PYG{o}{.}\PYG{o}{/}\PYG{n}{launcher} \PYG{n}{restart}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{presto-startuplog}.png}


\section{集群安装}
\label{\detokenize{installation/cluster:id1}}\label{\detokenize{installation/cluster::doc}}

\subsection{github下载安装包}
\label{\detokenize{installation/cluster:github}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{wget} \PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{github}\PYG{o}{.}\PYG{n}{com}\PYG{o}{/}\PYG{n}{prestodb}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{/}\PYG{n}{archive}\PYG{o}{/}\PYG{l+m+mf}{0.217}\PYG{o}{.}\PYG{n}{tar}\PYG{o}{.}\PYG{n}{gz}
\end{sphinxVerbatim}


\subsection{解压安装包}
\label{\detokenize{installation/cluster:id2}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{tar} \PYG{o}{\PYGZhy{}}\PYG{n}{xzvf} \PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.217}\PYG{o}{.}\PYG{n}{tar}\PYG{o}{.}\PYG{n}{gz} \PYG{o}{\PYGZhy{}}\PYG{n}{C} \PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{presto-dirs}.png}


\subsection{coordinator配置}
\label{\detokenize{installation/cluster:coordinator}}
coordinator服务器配置信息，主要包含config.properties和node.properties两方面配置信息。


\subsubsection{config.properties配置}
\label{\detokenize{installation/cluster:config-properties}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{coordinator}\PYG{o}{=}\PYG{n}{true}
\PYG{n}{node}\PYG{o}{\PYGZhy{}}\PYG{n}{scheduler}\PYG{o}{.}\PYG{n}{include}\PYG{o}{\PYGZhy{}}\PYG{n}{coordinator}\PYG{o}{=}\PYG{n}{false}
\PYG{n}{http}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{.}\PYG{n}{http}\PYG{o}{.}\PYG{n}{port}\PYG{o}{=}\PYG{l+m+mi}{9001}
\PYG{n}{query}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{memory}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{n}{GB}
\PYG{n}{query}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{memory}\PYG{o}{\PYGZhy{}}\PYG{n}{per}\PYG{o}{\PYGZhy{}}\PYG{n}{node}\PYG{o}{=}\PYG{l+m+mi}{512}\PYG{n}{MB}
\PYG{n}{query}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{total}\PYG{o}{\PYGZhy{}}\PYG{n}{memory}\PYG{o}{\PYGZhy{}}\PYG{n}{per}\PYG{o}{\PYGZhy{}}\PYG{n}{node}\PYG{o}{=}\PYG{l+m+mi}{512}\PYG{n}{MB}
\PYG{n}{discovery}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{.}\PYG{n}{enabled}\PYG{o}{=}\PYG{n}{true}
\PYG{n}{discovery}\PYG{o}{.}\PYG{n}{uri}\PYG{o}{=}\PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{172.31}\PYG{o}{.}\PYG{l+m+mf}{134.225}\PYG{p}{:}\PYG{l+m+mi}{9001}
\end{sphinxVerbatim}


\subsubsection{node.properties配置}
\label{\detokenize{installation/cluster:node-properties}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{node}\PYG{o}{.}\PYG{n}{environment}\PYG{o}{=}\PYG{n}{production}
\PYG{n}{node}\PYG{o}{.}\PYG{n}{id}\PYG{o}{=}\PYG{n}{ffffffff}\PYG{o}{\PYGZhy{}}\PYG{n}{ffff}\PYG{o}{\PYGZhy{}}\PYG{n}{ffff}\PYG{o}{\PYGZhy{}}\PYG{n}{ffff}\PYG{o}{\PYGZhy{}}\PYG{n}{ffffffffff01}
\PYG{n}{node}\PYG{o}{.}\PYG{n}{data}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{dir}\PYG{o}{=}\PYG{o}{/}\PYG{n}{opt}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{/}\PYG{n}{data217}
\end{sphinxVerbatim}


\subsection{worker配置}
\label{\detokenize{installation/cluster:worker}}
worker服务器配置信息，主要包含config.properties和node.properties两方面配置信息。


\subsubsection{config.properties配置}
\label{\detokenize{installation/cluster:id3}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{coordinator}\PYG{o}{=}\PYG{n}{false}
\PYG{n}{node}\PYG{o}{\PYGZhy{}}\PYG{n}{scheduler}\PYG{o}{.}\PYG{n}{include}\PYG{o}{\PYGZhy{}}\PYG{n}{coordinator}\PYG{o}{=}\PYG{n}{false}
\PYG{n}{http}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{.}\PYG{n}{http}\PYG{o}{.}\PYG{n}{port}\PYG{o}{=}\PYG{l+m+mi}{9001}
\PYG{n}{query}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{memory}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{n}{GB}
\PYG{n}{query}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{memory}\PYG{o}{\PYGZhy{}}\PYG{n}{per}\PYG{o}{\PYGZhy{}}\PYG{n}{node}\PYG{o}{=}\PYG{l+m+mi}{512}\PYG{n}{MB}
\PYG{n}{query}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{total}\PYG{o}{\PYGZhy{}}\PYG{n}{memory}\PYG{o}{\PYGZhy{}}\PYG{n}{per}\PYG{o}{\PYGZhy{}}\PYG{n}{node}\PYG{o}{=}\PYG{l+m+mi}{512}\PYG{n}{MB}
\PYG{n}{discovery}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{.}\PYG{n}{enabled}\PYG{o}{=}\PYG{n}{false}
\PYG{n}{discovery}\PYG{o}{.}\PYG{n}{uri}\PYG{o}{=}\PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{172.31}\PYG{o}{.}\PYG{l+m+mf}{134.225}\PYG{p}{:}\PYG{l+m+mi}{9001}
\end{sphinxVerbatim}


\subsubsection{node.properties配置}
\label{\detokenize{installation/cluster:id4}}
node.environment配置信息在worker节点和coordinator节点需要保持一致。node.id配置信息必须要唯一。node.data-dir配置目录建议保持一致，方便日志定位。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{node}\PYG{o}{.}\PYG{n}{environment}\PYG{o}{=}\PYG{n}{production}
\PYG{n}{node}\PYG{o}{.}\PYG{n}{id}\PYG{o}{=}\PYG{n}{ffffffff}\PYG{o}{\PYGZhy{}}\PYG{n}{ffff}\PYG{o}{\PYGZhy{}}\PYG{n}{ffff}\PYG{o}{\PYGZhy{}}\PYG{n}{ffff}\PYG{o}{\PYGZhy{}}\PYG{n}{ffffffffff02}
\PYG{n}{node}\PYG{o}{.}\PYG{n}{data}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{dir}\PYG{o}{=}\PYG{o}{/}\PYG{n}{opt}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{/}\PYG{n}{data217}
\end{sphinxVerbatim}


\subsection{修改jvm.properties配置}
\label{\detokenize{installation/cluster:jvm-properties}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZhy{}}\PYG{n}{server}
\PYG{o}{\PYGZhy{}}\PYG{n}{Xmx1G}
\PYG{o}{\PYGZhy{}}\PYG{n}{XX}\PYG{p}{:}\PYG{o}{+}\PYG{n}{UseG1GC}
\PYG{o}{\PYGZhy{}}\PYG{n}{XX}\PYG{p}{:}\PYG{n}{G1HeapRegionSize}\PYG{o}{=}\PYG{l+m+mi}{32}\PYG{n}{M}
\PYG{o}{\PYGZhy{}}\PYG{n}{XX}\PYG{p}{:}\PYG{o}{+}\PYG{n}{UseGCOverheadLimit}
\PYG{o}{\PYGZhy{}}\PYG{n}{XX}\PYG{p}{:}\PYG{o}{+}\PYG{n}{ExplicitGCInvokesConcurrent}
\PYG{o}{\PYGZhy{}}\PYG{n}{XX}\PYG{p}{:}\PYG{o}{+}\PYG{n}{HeapDumpOnOutOfMemoryError}
\PYG{o}{\PYGZhy{}}\PYG{n}{XX}\PYG{p}{:}\PYG{o}{+}\PYG{n}{ExitOnOutOfMemoryError}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
server

以java服务端进程启动

\item {} 
xmx

jvm最大堆内存，该值需要和query.max-memory-per-node之间有关联，不能够query.max-memory-per-node的值大于jvm最大堆大小。

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{query}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{memory}\PYG{o}{\PYGZhy{}}\PYG{n}{per}\PYG{o}{\PYGZhy{}}\PYG{n}{node} \PYG{o}{\PYGZlt{}} \PYG{n}{xmx}\PYG{o}{*}\PYG{l+m+mf}{0.8}
\PYG{n}{xmx} \PYG{o}{\PYGZgt{}} \PYG{n}{query}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{memory}\PYG{o}{\PYGZhy{}}\PYG{n}{per}\PYG{o}{\PYGZhy{}}\PYG{n}{node}\PYG{o}{/}\PYG{l+m+mf}{0.8}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
xx

UseG1GC使用的是g1的gc收集器进行新生代和老年代gc收集，目前g1是最新性能比较好的gc收集器。

\end{itemize}


\subsection{修改log.properties配置}
\label{\detokenize{installation/cluster:log-properties}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{com}\PYG{o}{.}\PYG{n}{facebook}\PYG{o}{.}\PYG{n}{presto}\PYG{o}{=}\PYG{n}{INFO}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
com.facebook.presto

presto的log日志级别

\end{itemize}


\subsection{presto服务启动}
\label{\detokenize{installation/cluster:presto}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{.}\PYG{o}{/}\PYG{n}{launcher} \PYG{n}{start}
\PYG{o}{.}\PYG{o}{/}\PYG{n}{launcher} \PYG{n}{restart}

 \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{n}{T17}\PYG{p}{:}\PYG{l+m+mi}{07}\PYG{p}{:}\PYG{l+m+mf}{15.791}\PYG{o}{+}\PYG{l+m+mi}{0800}    \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{Bootstrap}       \PYG{n}{elasticsearch}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{request}\PYG{o}{\PYGZhy{}}\PYG{n}{retries}          \PYG{l+m+mi}{5}                  \PYG{l+m+mi}{5}                  \PYG{n}{Maximum} \PYG{n}{number} \PYG{n}{of} \PYG{n}{Elasticsearch} \PYG{n}{request} \PYG{n}{retries}
 \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{n}{T17}\PYG{p}{:}\PYG{l+m+mi}{07}\PYG{p}{:}\PYG{l+m+mf}{15.791}\PYG{o}{+}\PYG{l+m+mi}{0800}    \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{Bootstrap}       \PYG{n}{elasticsearch}\PYG{o}{.}\PYG{n}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{request}\PYG{o}{\PYGZhy{}}\PYG{n}{retry}\PYG{o}{\PYGZhy{}}\PYG{n}{time}       \PYG{l+m+mf}{10.00}\PYG{n}{s}             \PYG{l+m+mf}{10.00}\PYG{n}{s}             \PYG{n}{Use} \PYG{n}{exponential} \PYG{n}{backoff} \PYG{n}{starting} \PYG{n}{at} \PYG{l+m+mi}{1}\PYG{n}{s} \PYG{n}{up} \PYG{n}{to} \PYG{n}{the} \PYG{n}{value} \PYG{n}{specified} \PYG{n}{by} \PYG{n}{this} \PYG{n}{configuration} \PYG{n}{when} \PYG{n}{retrying} \PYG{n}{failed} \PYG{n}{requests}
 \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{n}{T17}\PYG{p}{:}\PYG{l+m+mi}{07}\PYG{p}{:}\PYG{l+m+mf}{15.791}\PYG{o}{+}\PYG{l+m+mi}{0800}    \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{Bootstrap}       \PYG{n}{elasticsearch}\PYG{o}{.}\PYG{n}{request}\PYG{o}{\PYGZhy{}}\PYG{n}{timeout}              \PYG{l+m+mf}{100.00}\PYG{n}{ms}           \PYG{l+m+mf}{120.00}\PYG{n}{s}            \PYG{n}{Elasticsearch} \PYG{n}{request} \PYG{n}{timeout}
 \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{n}{T17}\PYG{p}{:}\PYG{l+m+mi}{07}\PYG{p}{:}\PYG{l+m+mf}{15.791}\PYG{o}{+}\PYG{l+m+mi}{0800}    \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{Bootstrap}       \PYG{n}{elasticsearch}\PYG{o}{.}\PYG{n}{scroll}\PYG{o}{\PYGZhy{}}\PYG{n}{size}                  \PYG{l+m+mi}{1000}               \PYG{l+m+mi}{1000000}            \PYG{n}{Scroll} \PYG{n}{batch} \PYG{n}{size}
 \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{n}{T17}\PYG{p}{:}\PYG{l+m+mi}{07}\PYG{p}{:}\PYG{l+m+mf}{15.791}\PYG{o}{+}\PYG{l+m+mi}{0800}    \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{Bootstrap}       \PYG{n}{elasticsearch}\PYG{o}{.}\PYG{n}{scroll}\PYG{o}{\PYGZhy{}}\PYG{n}{timeout}               \PYG{l+m+mf}{1.00}\PYG{n}{s}              \PYG{l+m+mf}{60000.00}\PYG{n}{ms}         \PYG{n}{Scroll} \PYG{n}{timeout}
 \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{n}{T17}\PYG{p}{:}\PYG{l+m+mi}{07}\PYG{p}{:}\PYG{l+m+mf}{15.791}\PYG{o}{+}\PYG{l+m+mi}{0800}    \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{Bootstrap}       \PYG{n}{elasticsearch}\PYG{o}{.}\PYG{n}{table}\PYG{o}{\PYGZhy{}}\PYG{n}{description}\PYG{o}{\PYGZhy{}}\PYG{n}{directory}  \PYG{n}{etc}\PYG{o}{/}\PYG{n}{elasticsearch}  \PYG{n}{etc}\PYG{o}{/}\PYG{n}{elasticsearch}  \PYG{n}{Directory} \PYG{n}{that} \PYG{n}{contains} \PYG{n}{JSON} \PYG{n}{table} \PYG{n}{description} \PYG{n}{files}
 \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{n}{T17}\PYG{p}{:}\PYG{l+m+mi}{07}\PYG{p}{:}\PYG{l+m+mf}{18.813}\PYG{o}{+}\PYG{l+m+mi}{0800}    \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{stderr}  \PYG{n}{ERROR} \PYG{n}{StatusLogger} \PYG{n}{No} \PYG{n}{log4j2} \PYG{n}{configuration} \PYG{n}{file} \PYG{n}{found}\PYG{o}{.} \PYG{n}{Using} \PYG{n}{default} \PYG{n}{configuration}\PYG{p}{:} \PYG{n}{logging} \PYG{n}{only} \PYG{n}{errors} \PYG{n}{to} \PYG{n}{the} \PYG{n}{console}\PYG{o}{.} \PYG{n}{Set} \PYG{n}{system} \PYG{n+nb}{property} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{log4j2.debug}\PYG{l+s+s1}{\PYGZsq{}} \PYG{n}{to} \PYG{n}{show} \PYG{n}{Log4j2} \PYG{n}{internal} \PYG{n}{initialization} \PYG{n}{logging}\PYG{o}{.}
 \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{n}{T17}\PYG{p}{:}\PYG{l+m+mi}{07}\PYG{p}{:}\PYG{l+m+mf}{24.028}\PYG{o}{+}\PYG{l+m+mi}{0800}    \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{com}\PYG{o}{.}\PYG{n}{facebook}\PYG{o}{.}\PYG{n}{presto}\PYG{o}{.}\PYG{n}{metadata}\PYG{o}{.}\PYG{n}{StaticCatalogStore} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Added} \PYG{n}{catalog} \PYG{n}{elasticsearch} \PYG{n}{using} \PYG{n}{connector} \PYG{n}{elasticsearch} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}
 \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{n}{T17}\PYG{p}{:}\PYG{l+m+mi}{07}\PYG{p}{:}\PYG{l+m+mf}{24.035}\PYG{o}{+}\PYG{l+m+mi}{0800}    \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{com}\PYG{o}{.}\PYG{n}{facebook}\PYG{o}{.}\PYG{n}{presto}\PYG{o}{.}\PYG{n}{security}\PYG{o}{.}\PYG{n}{AccessControlManager}       \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Loading} \PYG{n}{system} \PYG{n}{access} \PYG{n}{control} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}
 \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{n}{T17}\PYG{p}{:}\PYG{l+m+mi}{07}\PYG{p}{:}\PYG{l+m+mf}{24.037}\PYG{o}{+}\PYG{l+m+mi}{0800}    \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{com}\PYG{o}{.}\PYG{n}{facebook}\PYG{o}{.}\PYG{n}{presto}\PYG{o}{.}\PYG{n}{security}\PYG{o}{.}\PYG{n}{AccessControlManager}       \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Loaded} \PYG{n}{system} \PYG{n}{access} \PYG{n}{control} \PYG{n}{allow}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{all} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}
 \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{n}{T17}\PYG{p}{:}\PYG{l+m+mi}{07}\PYG{p}{:}\PYG{l+m+mf}{24.225}\PYG{o}{+}\PYG{l+m+mi}{0800}    \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{com}\PYG{o}{.}\PYG{n}{facebook}\PYG{o}{.}\PYG{n}{presto}\PYG{o}{.}\PYG{n}{server}\PYG{o}{.}\PYG{n}{PrestoServer} \PYG{o}{==}\PYG{o}{==}\PYG{o}{==}\PYG{o}{==} \PYG{n}{SERVER} \PYG{n}{STARTED} \PYG{o}{==}\PYG{o}{==}\PYG{o}{==}\PYG{o}{==}
\end{sphinxVerbatim}


\section{客户端安装}
\label{\detokenize{installation/client:id1}}\label{\detokenize{installation/client::doc}}

\subsection{cli下载}
\label{\detokenize{installation/client:cli}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{wget} \PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{repo1}\PYG{o}{.}\PYG{n}{maven}\PYG{o}{.}\PYG{n}{org}\PYG{o}{/}\PYG{n}{maven2}\PYG{o}{/}\PYG{n}{com}\PYG{o}{/}\PYG{n}{facebook}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{cli}\PYG{o}{/}\PYG{l+m+mf}{0.224}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{cli}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.224}\PYG{o}{\PYGZhy{}}\PYG{n}{executable}\PYG{o}{.}\PYG{n}{jar}
\end{sphinxVerbatim}


\subsection{制作可执行客户端}
\label{\detokenize{installation/client:id2}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{mv} \PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{cli}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.224}\PYG{o}{\PYGZhy{}}\PYG{n}{executable}\PYG{o}{.}\PYG{n}{jar} \PYG{n}{presto}
\PYG{n}{chmod} \PYG{o}{+}\PYG{n}{x} \PYG{n}{presto}
\end{sphinxVerbatim}


\subsection{客户端使用}
\label{\detokenize{installation/client:id3}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{.}\PYG{o}{/}\PYG{n}{presto} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{server} \PYG{n}{localhost}\PYG{p}{:}\PYG{l+m+mi}{9001} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{schema} \PYG{n}{default} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{catalog} \PYG{n}{elasticsearch}
\end{sphinxVerbatim}


\subsection{软连接建立}
\label{\detokenize{installation/client:id4}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{ln} \PYG{o}{\PYGZhy{}}\PYG{n}{s} \PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.217}\PYG{o}{/}\PYG{n}{presto} \PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}\PYG{o}{/}\PYG{n+nb}{bin}\PYG{o}{/}\PYG{n}{presto}
\end{sphinxVerbatim}


\section{presto校验}
\label{\detokenize{installation/verifier:presto}}\label{\detokenize{installation/verifier::doc}}

\subsection{verifier下载}
\label{\detokenize{installation/verifier:verifier}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{wget} \PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{repo1}\PYG{o}{.}\PYG{n}{maven}\PYG{o}{.}\PYG{n}{org}\PYG{o}{/}\PYG{n}{maven2}\PYG{o}{/}\PYG{n}{com}\PYG{o}{/}\PYG{n}{facebook}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{verifier}\PYG{o}{/}\PYG{l+m+mf}{0.217}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{verifier}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.217}\PYG{o}{\PYGZhy{}}\PYG{n}{executable}\PYG{o}{.}\PYG{n}{jar}
\end{sphinxVerbatim}


\subsection{制作可执行客户端}
\label{\detokenize{installation/verifier:id1}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{mv} \PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{verifier}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.224}\PYG{o}{\PYGZhy{}}\PYG{n}{executable}\PYG{o}{.}\PYG{n}{jar} \PYG{n}{verifier}
\PYG{n}{chmod} \PYG{o}{+}\PYG{n}{x} \PYG{n}{verifier}
\end{sphinxVerbatim}


\subsection{表创建}
\label{\detokenize{installation/verifier:id2}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{CREATE} \PYG{n}{TABLE} \PYG{n}{verifier\PYGZus{}queries} \PYG{p}{(}
   \PYG{n+nb}{id} \PYG{n+nb}{int}\PYG{p}{(}\PYG{l+m+mi}{11}\PYG{p}{)} \PYG{n}{unsigned} \PYG{n}{NOT} \PYG{n}{NULL} \PYG{n}{PRIMARY} \PYG{n}{KEY} \PYG{n}{AUTO\PYGZus{}INCREMENT}\PYG{p}{,}
   \PYG{n}{suite} \PYG{n}{varchar}\PYG{p}{(}\PYG{l+m+mi}{256}\PYG{p}{)} \PYG{n}{NOT} \PYG{n}{NULL}\PYG{p}{,}
   \PYG{n}{name} \PYG{n}{varchar}\PYG{p}{(}\PYG{l+m+mi}{256}\PYG{p}{)} \PYG{n}{DEFAULT} \PYG{n}{NULL}\PYG{p}{,}
   \PYG{n}{control\PYGZus{}catalog} \PYG{n}{varchar}\PYG{p}{(}\PYG{l+m+mi}{256}\PYG{p}{)} \PYG{n}{NOT} \PYG{n}{NULL}\PYG{p}{,}
   \PYG{n}{control\PYGZus{}schema} \PYG{n}{varchar}\PYG{p}{(}\PYG{l+m+mi}{256}\PYG{p}{)} \PYG{n}{NOT} \PYG{n}{NULL}\PYG{p}{,}
   \PYG{n}{control\PYGZus{}query} \PYG{n}{text} \PYG{n}{NOT} \PYG{n}{NULL}\PYG{p}{,}
   \PYG{n}{test\PYGZus{}catalog} \PYG{n}{varchar}\PYG{p}{(}\PYG{l+m+mi}{256}\PYG{p}{)} \PYG{n}{NOT} \PYG{n}{NULL}\PYG{p}{,}
   \PYG{n}{test\PYGZus{}schema} \PYG{n}{varchar}\PYG{p}{(}\PYG{l+m+mi}{256}\PYG{p}{)} \PYG{n}{NOT} \PYG{n}{NULL}\PYG{p}{,}
   \PYG{n}{test\PYGZus{}query} \PYG{n}{text} \PYG{n}{NOT} \PYG{n}{NULL}\PYG{p}{,}
   \PYG{n}{control\PYGZus{}username} \PYG{n}{varchar}\PYG{p}{(}\PYG{l+m+mi}{256}\PYG{p}{)} \PYG{n}{NOT} \PYG{n}{NULL} \PYG{n}{DEFAULT} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{verifier\PYGZhy{}test}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
   \PYG{n}{control\PYGZus{}password} \PYG{n}{varchar}\PYG{p}{(}\PYG{l+m+mi}{256}\PYG{p}{)} \PYG{n}{DEFAULT} \PYG{n}{NULL}\PYG{p}{,}
   \PYG{n}{test\PYGZus{}username} \PYG{n}{varchar}\PYG{p}{(}\PYG{l+m+mi}{256}\PYG{p}{)} \PYG{n}{NOT} \PYG{n}{NULL} \PYG{n}{DEFAULT} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{verifier\PYGZhy{}test}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
   \PYG{n}{test\PYGZus{}password} \PYG{n}{varchar}\PYG{p}{(}\PYG{l+m+mi}{256}\PYG{p}{)} \PYG{n}{DEFAULT} \PYG{n}{NULL}\PYG{p}{,}
   \PYG{n}{session\PYGZus{}properties\PYGZus{}json} \PYG{n}{varchar}\PYG{p}{(}\PYG{l+m+mi}{2048}\PYG{p}{)} \PYG{n}{DEFAULT} \PYG{n}{NULL}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{config.properties}
\label{\detokenize{installation/verifier:config-properties}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
source\PYGZhy{}query.suite=my\PYGZus{}suite
source\PYGZhy{}query.database=jdbc:mysql://localhost:3306/my\PYGZus{}database?user=my\PYGZus{}username\PYGZam{}password=my\PYGZus{}password
control.gateway=jdbc:presto://localhost:8080
test.gateway=jdbc:presto://localhost:8081
test\PYGZhy{}id=1
\end{sphinxVerbatim}


\subsection{客户端使用}
\label{\detokenize{installation/verifier:id3}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{.}\PYG{o}{/}\PYG{n}{verifier} \PYG{n}{verify} \PYG{n}{config}\PYG{o}{.}\PYG{n}{properties}
\end{sphinxVerbatim}


\subsection{软连接建立}
\label{\detokenize{installation/verifier:id4}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{ln} \PYG{o}{\PYGZhy{}}\PYG{n}{s} \PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.217}\PYG{o}{/}\PYG{n}{verifier} \PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}\PYG{o}{/}\PYG{n+nb}{bin}\PYG{o}{/}\PYG{n}{verifier}
\end{sphinxVerbatim}


\section{benchmark性能测试}
\label{\detokenize{installation/benchmark:benchmark}}\label{\detokenize{installation/benchmark::doc}}

\subsection{benchmark下载}
\label{\detokenize{installation/benchmark:id1}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{wget} \PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{repo1}\PYG{o}{.}\PYG{n}{maven}\PYG{o}{.}\PYG{n}{org}\PYG{o}{/}\PYG{n}{maven2}\PYG{o}{/}\PYG{n}{com}\PYG{o}{/}\PYG{n}{facebook}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{benchmark}\PYG{o}{\PYGZhy{}}\PYG{n}{driver}\PYG{o}{/}\PYG{l+m+mf}{0.217}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{benchmark}\PYG{o}{\PYGZhy{}}\PYG{n}{driver}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.217}\PYG{o}{\PYGZhy{}}\PYG{n}{executable}\PYG{o}{.}\PYG{n}{jar}
\end{sphinxVerbatim}


\subsection{制作可执行客户端}
\label{\detokenize{installation/benchmark:id2}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{mv} \PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{benchmark}\PYG{o}{\PYGZhy{}}\PYG{n}{driver}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.217}\PYG{o}{\PYGZhy{}}\PYG{n}{executable}\PYG{o}{.}\PYG{n}{jar} \PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{benchmark}\PYG{o}{\PYGZhy{}}\PYG{n}{driver}
\PYG{n}{chmod} \PYG{o}{+}\PYG{n}{x} \PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{benchmark}\PYG{o}{\PYGZhy{}}\PYG{n}{driver}
\end{sphinxVerbatim}


\subsection{使用方式}
\label{\detokenize{installation/benchmark:id3}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}\PYG{n+nd}{@docker}\PYG{p}{:}\PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.217}\PYG{c+c1}{\PYGZsh{} ./presto\PYGZhy{}benchmark\PYGZhy{}driver \PYGZhy{}\PYGZhy{}help}
\PYG{n}{NAME}
        \PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{benchmark} \PYG{o}{\PYGZhy{}} \PYG{n}{Presto} \PYG{n}{benchmark} \PYG{n}{driver}

\PYG{n}{SYNOPSIS}
        \PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{benchmark} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{catalog} \PYG{o}{\PYGZlt{}}\PYG{n}{catalog}\PYG{o}{\PYGZgt{}}\PYG{p}{]}
                \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{client}\PYG{o}{\PYGZhy{}}\PYG{n}{request}\PYG{o}{\PYGZhy{}}\PYG{n}{timeout} \PYG{o}{\PYGZlt{}}\PYG{n}{client} \PYG{n}{request} \PYG{n}{timeout}\PYG{o}{\PYGZgt{}}\PYG{p}{]} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{debug}\PYG{p}{]}
                \PYG{p}{[}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{n}{h} \PYG{o}{\textbar{}} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{help}\PYG{p}{)}\PYG{p}{]} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{failures} \PYG{o}{\PYGZlt{}}\PYG{n+nb}{max} \PYG{n}{failures}\PYG{o}{\PYGZgt{}}\PYG{p}{]} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{query} \PYG{o}{\PYGZlt{}}\PYG{n}{query}\PYG{o}{\PYGZgt{}}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{p}{]}
                \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{runs} \PYG{o}{\PYGZlt{}}\PYG{n}{runs}\PYG{o}{\PYGZgt{}}\PYG{p}{]} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{schema} \PYG{o}{\PYGZlt{}}\PYG{n}{schema}\PYG{o}{\PYGZgt{}}\PYG{p}{]} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{server} \PYG{o}{\PYGZlt{}}\PYG{n}{server}\PYG{o}{\PYGZgt{}}\PYG{p}{]}
                \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{session} \PYG{o}{\PYGZlt{}}\PYG{n}{session}\PYG{o}{\PYGZgt{}}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{p}{]} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{socks} \PYG{o}{\PYGZlt{}}\PYG{n}{socks}\PYG{o}{\PYGZgt{}}\PYG{p}{]} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{sql} \PYG{o}{\PYGZlt{}}\PYG{n}{sql}\PYG{o}{\PYGZgt{}}\PYG{p}{]}
                \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{suite} \PYG{o}{\PYGZlt{}}\PYG{n}{suite}\PYG{o}{\PYGZgt{}}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{p}{]} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{suite}\PYG{o}{\PYGZhy{}}\PYG{n}{config} \PYG{o}{\PYGZlt{}}\PYG{n}{suite}\PYG{o}{\PYGZhy{}}\PYG{n}{config}\PYG{o}{\PYGZgt{}}\PYG{p}{]} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{user} \PYG{o}{\PYGZlt{}}\PYG{n}{user}\PYG{o}{\PYGZgt{}}\PYG{p}{]}
                \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{warm} \PYG{o}{\PYGZlt{}}\PYG{n}{warm}\PYG{o}{\PYGZgt{}}\PYG{p}{]}

\PYG{n}{OPTIONS}
        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{catalog} \PYG{o}{\PYGZlt{}}\PYG{n}{catalog}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Default} \PYG{n}{catalog}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{client}\PYG{o}{\PYGZhy{}}\PYG{n}{request}\PYG{o}{\PYGZhy{}}\PYG{n}{timeout} \PYG{o}{\PYGZlt{}}\PYG{n}{client} \PYG{n}{request} \PYG{n}{timeout}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Client} \PYG{n}{request} \PYG{n}{timeout} \PYG{p}{(}\PYG{n}{default}\PYG{p}{:} \PYG{l+m+mi}{2}\PYG{n}{m}\PYG{p}{)}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{debug}
            \PYG{n}{Enable} \PYG{n}{debug} \PYG{n}{information} \PYG{p}{(}\PYG{n}{default}\PYG{p}{:} \PYG{n}{false}\PYG{p}{)}

        \PYG{o}{\PYGZhy{}}\PYG{n}{h}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{help}
            \PYG{n}{Display} \PYG{n}{help} \PYG{n}{information}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{max}\PYG{o}{\PYGZhy{}}\PYG{n}{failures} \PYG{o}{\PYGZlt{}}\PYG{n+nb}{max} \PYG{n}{failures}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Max} \PYG{n}{number} \PYG{n}{of} \PYG{n}{consecutive} \PYG{n}{failures} \PYG{n}{before} \PYG{n}{benchmark} \PYG{n}{fails}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{query} \PYG{o}{\PYGZlt{}}\PYG{n}{query}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Queries} \PYG{n}{to} \PYG{n}{execute}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{runs} \PYG{o}{\PYGZlt{}}\PYG{n}{runs}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Number} \PYG{n}{of} \PYG{n}{times} \PYG{n}{to} \PYG{n}{run} \PYG{n}{each} \PYG{n}{query} \PYG{p}{(}\PYG{n}{default}\PYG{p}{:} \PYG{l+m+mi}{3}\PYG{p}{)}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{schema} \PYG{o}{\PYGZlt{}}\PYG{n}{schema}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Default} \PYG{n}{schema}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{server} \PYG{o}{\PYGZlt{}}\PYG{n}{server}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Presto} \PYG{n}{server} \PYG{n}{location} \PYG{p}{(}\PYG{n}{default}\PYG{p}{:} \PYG{n}{localhost}\PYG{p}{:}\PYG{l+m+mi}{8080}\PYG{p}{)}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{session} \PYG{o}{\PYGZlt{}}\PYG{n}{session}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Session} \PYG{n+nb}{property} \PYG{p}{(}\PYG{n+nb}{property} \PYG{n}{can} \PYG{n}{be} \PYG{n}{used} \PYG{n}{multiple} \PYG{n}{times}\PYG{p}{;} \PYG{n+nb}{format} \PYG{o+ow}{is}
            \PYG{n}{key}\PYG{o}{=}\PYG{n}{value}\PYG{p}{)}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{socks} \PYG{o}{\PYGZlt{}}\PYG{n}{socks}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Socks} \PYG{n}{proxy} \PYG{n}{to} \PYG{n}{use}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{sql} \PYG{o}{\PYGZlt{}}\PYG{n}{sql}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Directory} \PYG{n}{containing} \PYG{n}{sql} \PYG{n}{files} \PYG{p}{(}\PYG{n}{default}\PYG{p}{:} \PYG{n}{sql}\PYG{p}{)}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{suite} \PYG{o}{\PYGZlt{}}\PYG{n}{suite}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Suite} \PYG{n}{to} \PYG{n}{execute}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{suite}\PYG{o}{\PYGZhy{}}\PYG{n}{config} \PYG{o}{\PYGZlt{}}\PYG{n}{suite}\PYG{o}{\PYGZhy{}}\PYG{n}{config}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Suites} \PYG{n}{configuration} \PYG{n}{file} \PYG{p}{(}\PYG{n}{default}\PYG{p}{:} \PYG{n}{suite}\PYG{o}{.}\PYG{n}{json}\PYG{p}{)}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{user} \PYG{o}{\PYGZlt{}}\PYG{n}{user}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Username}

        \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{warm} \PYG{o}{\PYGZlt{}}\PYG{n}{warm}\PYG{o}{\PYGZgt{}}
            \PYG{n}{Number} \PYG{n}{of} \PYG{n}{times} \PYG{n}{to} \PYG{n}{run} \PYG{n}{each} \PYG{n}{query} \PYG{k}{for} \PYG{n}{a} \PYG{n}{warm}\PYG{o}{\PYGZhy{}}\PYG{n}{up} \PYG{p}{(}\PYG{n}{default}\PYG{p}{:} \PYG{l+m+mi}{1}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{创建suite.json}
\label{\detokenize{installation/benchmark:suite-json}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}\PYG{n+nd}{@docker}\PYG{p}{:}\PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.217}\PYG{c+c1}{\PYGZsh{} vim suite.json}
\PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{file\PYGZus{}formats}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}
         \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{query}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{test.*}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
         \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{schema}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{test.*}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
         \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
file\_formats

测试suite单元

\item {} 
query

匹配sql文件的sql正则表达式

\item {} 
schema

匹配的schema正则表达式

\item {} 
session
查询携带的参数信息

\end{itemize}


\subsection{创建sql文件}
\label{\detokenize{installation/benchmark:sql}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}\PYG{n+nd}{@docker}\PYG{p}{:}\PYG{n}{mkdir} \PYG{n}{sql}

\PYG{n}{root}\PYG{n+nd}{@docker}\PYG{p}{:}\PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.217}\PYG{c+c1}{\PYGZsh{} vim sql/test.sql}

\PYG{n}{select} \PYG{n}{count}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)} \PYG{k+kn}{from} \PYG{n+nn}{hive}\PYG{n+nn}{.}\PYG{n+nn}{test}\PYG{n+nn}{.}\PYG{n+nn}{t\PYGZus{}ods\PYGZus{}industry\PYGZus{}atd}\PYG{p}{;}
\end{sphinxVerbatim}


\subsection{执行benchmark}
\label{\detokenize{installation/benchmark:id4}}
在同目录下创建sql目录，然后在目录里面添加test.sql,每个sql文件只能包含一条sql语句，不能以’,’号分割多条sql语句。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{.}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{benchmark}\PYG{o}{\PYGZhy{}}\PYG{n}{driver} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{server} \PYG{l+m+mf}{172.31}\PYG{o}{.}\PYG{l+m+mf}{134.225}\PYG{p}{:}\PYG{l+m+mi}{9001}  \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{debug} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{suite}\PYG{o}{\PYGZhy{}}\PYG{n}{config} \PYG{n}{suite}\PYG{o}{.}\PYG{n}{json}  \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{catalog} \PYG{n}{hive} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{warm} \PYG{l+m+mi}{10}

\PYG{n}{root}\PYG{n+nd}{@docker}\PYG{p}{:}\PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}\PYG{o}{/}\PYG{n}{presto}\PYG{o}{\PYGZhy{}}\PYG{n}{server}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.217}\PYG{c+c1}{\PYGZsh{} ./presto\PYGZhy{}benchmark\PYGZhy{}driver \PYGZhy{}\PYGZhy{}server 172.31.134.225:9001  \PYGZhy{}\PYGZhy{}debug  \PYGZhy{}\PYGZhy{}catalog hive  \PYGZhy{}\PYGZhy{}warm 10}
\PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{21}\PYG{n}{T09}\PYG{p}{:}\PYG{l+m+mi}{41}\PYG{p}{:}\PYG{l+m+mf}{27.936}\PYG{o}{+}\PYG{l+m+mi}{0800}        \PYG{n}{INFO}    \PYG{n}{main}    \PYG{n}{io}\PYG{o}{.}\PYG{n}{airlift}\PYG{o}{.}\PYG{n}{log}\PYG{o}{.}\PYG{n}{Logging}  \PYG{n}{Logging} \PYG{n}{to} \PYG{n}{stderr}
\PYG{n}{suite}       \PYG{n}{query}   \PYG{n}{compression}     \PYG{n+nb}{format}  \PYG{n}{scale}   \PYG{n}{wallTimeP50}     \PYG{n}{wallTimeMean}    \PYG{n}{wallTimeStd}     \PYG{n}{processCpuTimeP50}       \PYG{n}{processCpuTimeMean}      \PYG{n}{processCpuTimeStd}       \PYG{n}{queryCpuTimeP50} \PYG{n}{queryCpuTimeMean}        \PYG{n}{queryCpuTimeStstatus}    \PYG{n}{error}
\PYG{n}{file\PYGZus{}formats}        \PYG{n}{test}                            \PYG{l+m+mi}{742}     \PYG{l+m+mi}{773}     \PYG{l+m+mi}{79}      \PYG{l+m+mi}{2630}    \PYG{l+m+mi}{2746}    \PYG{l+m+mi}{311}     \PYG{l+m+mi}{216}     \PYG{l+m+mi}{217}   \PYG{l+m+mi}{12}        \PYG{k}{pass}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
suite

执行的suite

\item {} 
query

执行的sql文件

\item {} 
compression

压缩方式，none、snappy、zlib

\item {} 
format

文件存储格式

\item {} 
scale

执行次数，compression、format、scale参数都是从schema匹配 “tpch\_sf(?\textless{}scale\textgreater{}.*)\_(?\textless{}format\textgreater{}orc)\_(?\textless{}compression\textgreater{}.*?)”获取的数据类型，
如tpch\_sf100\_orc\_snappy。

\item {} 
WallTime

用户要可以看到查询结果要等待的时间，median, mean and standard deviation of the query runs

\item {} 
processCpuTime

整个集群为助理查询而消耗的CPU时间，包含一些垃圾回收的时间，median, mean and standard deviation of the query runs

\item {} 
queryCpuTime

整个集群为助理查询而消耗的CPU时间，median, mean and standard deviation of the query runs

\end{itemize}


\section{webUI界面}
\label{\detokenize{installation/webui:webui}}\label{\detokenize{installation/webui::doc}}

\subsection{aripal webUI}
\label{\detokenize{installation/webui:aripal-webui}}
aripal是airbnb专门为presto开发的一个web界面，可以通过web界面，对presto指定查询，做bi分析。详情查看: \sphinxurl{https://github.com/airbnb/airpal}。


\subsubsection{aripal下载}
\label{\detokenize{installation/webui:aripal}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{wget} \PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{github}\PYG{o}{.}\PYG{n}{com}\PYG{o}{/}\PYG{n}{airbnb}\PYG{o}{/}\PYG{n}{airpal}\PYG{o}{/}\PYG{n}{archive}\PYG{o}{/}\PYG{n}{master}\PYG{o}{.}\PYG{n}{zip}
\end{sphinxVerbatim}


\subsubsection{aripal环境}
\label{\detokenize{installation/webui:id2}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{apt} \PYG{n}{install} \PYG{n}{nodejs}
\PYG{n}{apt} \PYG{n}{install} \PYG{n}{npm}
\PYG{n}{apt} \PYG{n}{install} \PYG{n}{gradle}
\end{sphinxVerbatim}


\subsubsection{aripal编译}
\label{\detokenize{installation/webui:id3}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{unzip} \PYG{n}{master}\PYG{o}{.}\PYG{n}{zip}
\PYG{n}{cd} \PYG{n}{airpal}\PYG{o}{\PYGZhy{}}\PYG{n}{master}

\PYG{n}{修改build}\PYG{o}{.}\PYG{n}{gradle} \PYG{n}{添加postgresql依赖}
\PYG{n+nb}{compile} \PYG{n}{group}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mysql}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{name}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mysql\PYGZhy{}connector\PYGZhy{}java}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{version}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{5.1.34}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n+nb}{compile} \PYG{n}{group}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{org.postgresql}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{name}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{postgresql}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{version}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{42.2.5}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n+nb}{compile} \PYG{n}{group}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.h2database}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{name}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{h2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{version}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1.4.190}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{o}{.}\PYG{o}{/}\PYG{n}{gradlew} \PYG{n}{clean} \PYG{n}{shadowJar}
\end{sphinxVerbatim}


\subsubsection{aripal配置}
\label{\detokenize{installation/webui:id4}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}\PYG{n+nd}{@docker}\PYG{p}{:}\PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}\PYG{o}{/}\PYG{n}{soft}\PYG{o}{/}\PYG{n}{airpal}\PYG{o}{\PYGZhy{}}\PYG{n}{master}\PYG{c+c1}{\PYGZsh{} vim reference.yml}
\PYG{c+c1}{\PYGZsh{} Logging settings}
\PYG{n}{logging}\PYG{p}{:}

  \PYG{n}{loggers}\PYG{p}{:}
     \PYG{n}{org}\PYG{o}{.}\PYG{n}{apache}\PYG{o}{.}\PYG{n}{shiro}\PYG{p}{:} \PYG{n}{INFO}

 \PYG{c+c1}{\PYGZsh{} The default level of all loggers. Can be OFF, ERROR, WARN, INFO, DEBUG, TRACE, or ALL.}
  \PYG{n}{level}\PYG{p}{:} \PYG{n}{INFO}

\PYG{c+c1}{\PYGZsh{} HTTP\PYGZhy{}specific options.}
\PYG{n}{server}\PYG{p}{:}
  \PYG{n}{applicationConnectors}\PYG{p}{:}
    \PYG{o}{\PYGZhy{}} \PYG{n+nb}{type}\PYG{p}{:} \PYG{n}{http}
      \PYG{n}{port}\PYG{p}{:} \PYG{l+m+mi}{8081}
      \PYG{n}{idleTimeout}\PYG{p}{:} \PYG{l+m+mi}{10} \PYG{n}{seconds}

  \PYG{n}{adminConnectors}\PYG{p}{:}
    \PYG{o}{\PYGZhy{}} \PYG{n+nb}{type}\PYG{p}{:} \PYG{n}{http}
      \PYG{n}{port}\PYG{p}{:} \PYG{l+m+mi}{8082}

\PYG{n}{shiro}\PYG{p}{:}
  \PYG{n}{iniConfigs}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{classpath:shiro\PYGZus{}allow\PYGZus{}all.ini}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}

\PYG{n}{dataSourceFactory}\PYG{p}{:}
  \PYG{n}{driverClass}\PYG{p}{:} \PYG{n}{org}\PYG{o}{.}\PYG{n}{postgresql}\PYG{o}{.}\PYG{n}{Driver}
  \PYG{n}{user}\PYG{p}{:} \PYG{n}{ads}
  \PYG{n}{password}\PYG{p}{:} \PYG{n}{ads}\PYG{n+nd}{@123}
  \PYG{n}{url}\PYG{p}{:} \PYG{n}{jdbc}\PYG{p}{:}\PYG{n}{postgresql}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{172.31}\PYG{o}{.}\PYG{l+m+mf}{134.225}\PYG{p}{:}\PYG{l+m+mi}{5432}\PYG{o}{/}\PYG{n}{hue}

\PYG{n}{flywayFactory}\PYG{p}{:}
  \PYG{n}{locations}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{classpath:db.migration.common}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{classpath:db.migration.mysql}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{classpath:org.postgresql}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{} The URL to the Presto coordinator.}
\PYG{n}{prestoCoordinator}\PYG{p}{:} \PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{172.31}\PYG{o}{.}\PYG{l+m+mf}{134.225}\PYG{p}{:}\PYG{l+m+mi}{9001}
\end{sphinxVerbatim}


\subsubsection{aripal运行}
\label{\detokenize{installation/webui:id5}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{java} \PYG{o}{\PYGZhy{}}\PYG{n}{Duser}\PYG{o}{.}\PYG{n}{timezone}\PYG{o}{=}\PYG{n}{UTC} \PYG{o}{\PYGZhy{}}\PYG{n}{cp} \PYG{n}{build}\PYG{o}{/}\PYG{n}{libs}\PYG{o}{/}\PYG{n}{airpal}\PYG{o}{\PYGZhy{}}\PYG{o}{*}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{all}\PYG{o}{.}\PYG{n}{jar} \PYG{n}{com}\PYG{o}{.}\PYG{n}{airbnb}\PYG{o}{.}\PYG{n}{airpal}\PYG{o}{.}\PYG{n}{AirpalApplication} \PYG{n}{db} \PYG{n}{migrate} \PYG{n}{reference}\PYG{o}{.}\PYG{n}{yml}

\PYG{n}{java} \PYG{o}{\PYGZhy{}}\PYG{n}{server} \PYG{o}{\PYGZhy{}}\PYG{n}{Duser}\PYG{o}{.}\PYG{n}{timezone}\PYG{o}{=}\PYG{n}{UTC} \PYG{o}{\PYGZhy{}}\PYG{n}{cp} \PYG{n}{build}\PYG{o}{/}\PYG{n}{libs}\PYG{o}{/}\PYG{n}{airpal}\PYG{o}{\PYGZhy{}}\PYG{o}{*}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{all}\PYG{o}{.}\PYG{n}{jar} \PYG{n}{com}\PYG{o}{.}\PYG{n}{airbnb}\PYG{o}{.}\PYG{n}{airpal}\PYG{o}{.}\PYG{n}{AirpalApplication} \PYG{n}{server} \PYG{n}{reference}\PYG{o}{.}\PYG{n}{yml}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{presto-airpall}.png}


\subsection{shib webUI}
\label{\detokenize{installation/webui:shib-webui}}
shib是专门为SQL-Like 大数据分析组件设计的来进行数据查询、数据统计的bi工具，支持hive、hive2、presto、bigQuery等大数据工具。详情查看: \sphinxurl{https://github.com/tagomoris/shib}。


\subsubsection{shib下载}
\label{\detokenize{installation/webui:shib}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{wget} \PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{github}\PYG{o}{.}\PYG{n}{com}\PYG{o}{/}\PYG{n}{tagomoris}\PYG{o}{/}\PYG{n}{shib}\PYG{o}{/}\PYG{n}{archive}\PYG{o}{/}\PYG{n}{v1}\PYG{o}{.}\PYG{l+m+mf}{0.2}\PYG{o}{.}\PYG{n}{tar}\PYG{o}{.}\PYG{n}{gz}
\end{sphinxVerbatim}


\subsubsection{shib依赖环境}
\label{\detokenize{installation/webui:id7}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{apt} \PYG{n}{install} \PYG{n}{nodejs}
\PYG{n}{apt} \PYG{n}{install} \PYG{n}{npm}
\PYG{n}{npm} \PYG{n}{install} \PYG{o}{\PYGZhy{}}\PYG{n}{g} \PYG{n}{cnpm} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{registry}\PYG{o}{=}\PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{registry}\PYG{o}{.}\PYG{n}{npm}\PYG{o}{.}\PYG{n}{taobao}\PYG{o}{.}\PYG{n}{org}
\end{sphinxVerbatim}


\subsubsection{shib安装}
\label{\detokenize{installation/webui:id8}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{tar} \PYG{o}{\PYGZhy{}}\PYG{n}{xzvf} \PYG{n}{shib}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{o}{.}\PYG{l+m+mf}{2.}\PYG{n}{tar}\PYG{o}{.}\PYG{n}{gz} \PYG{o}{\PYGZhy{}}\PYG{n}{C} \PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}
\PYG{n}{cd} \PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n}{local}\PYG{o}{/}
\PYG{n}{cnpm} \PYG{n}{install}
\end{sphinxVerbatim}


\subsubsection{hiveserver2配置}
\label{\detokenize{installation/webui:hiveserver2}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{vi} \PYG{n}{config}\PYG{o}{.}\PYG{n}{js}

\PYG{n}{var} \PYG{n}{servers} \PYG{o}{=} \PYG{n}{exports}\PYG{o}{.}\PYG{n}{servers} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n}{listen}\PYG{p}{:} \PYG{l+m+mi}{3000}\PYG{p}{,}
  \PYG{n}{fetch\PYGZus{}lines}\PYG{p}{:} \PYG{l+m+mi}{1000}\PYG{p}{,}
  \PYG{n}{query\PYGZus{}timeout}\PYG{p}{:} \PYG{l+m+mi}{30}\PYG{p}{,} \PYG{o}{/}\PYG{o}{/} \PYG{l+m+mi}{30} \PYG{n}{seconds} \PYG{k}{for} \PYG{n}{Presto} \PYG{n}{query} \PYG{n}{timeouts} \PYG{p}{(}\PYG{n}{it} \PYG{n}{will} \PYG{n}{fail}\PYG{p}{)}
  \PYG{n}{setup\PYGZus{}queries}\PYG{p}{:} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,}
  \PYG{n}{storage}\PYG{p}{:} \PYG{p}{\PYGZob{}}
    \PYG{n}{datadir}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{./var}\PYG{l+s+s1}{\PYGZsq{}}
  \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{n}{engines}\PYG{p}{:} \PYG{p}{[}
    \PYG{p}{\PYGZob{}} \PYG{n}{label}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{hivecluster1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
      \PYG{n}{executer}\PYG{p}{:} \PYG{p}{\PYGZob{}}
        \PYG{n}{name}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{presto}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{host}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{172.31.134.225}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{port}\PYG{p}{:} \PYG{l+m+mi}{9001}\PYG{p}{,}
        \PYG{n}{user}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{admin}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{catalog}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{hive}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{support\PYGZus{}database}\PYG{p}{:} \PYG{n}{true}\PYG{p}{,}
        \PYG{n}{default\PYGZus{}database}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{test}\PYG{l+s+s1}{\PYGZsq{}}
      \PYG{p}{\PYGZcb{}}\PYG{p}{,}
      \PYG{n}{monitor}\PYG{p}{:} \PYG{n}{null}
    \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{]}\PYG{p}{,}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}
\end{sphinxVerbatim}


\subsubsection{presto配置}
\label{\detokenize{installation/webui:presto}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{vi} \PYG{n}{config}\PYG{o}{.}\PYG{n}{js}

\PYG{n}{var} \PYG{n}{servers} \PYG{o}{=} \PYG{n}{exports}\PYG{o}{.}\PYG{n}{servers} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n}{listen}\PYG{p}{:} \PYG{l+m+mi}{3000}\PYG{p}{,}
  \PYG{n}{fetch\PYGZus{}lines}\PYG{p}{:} \PYG{l+m+mi}{1000}\PYG{p}{,}
  \PYG{n}{query\PYGZus{}timeout}\PYG{p}{:} \PYG{l+m+mi}{30}\PYG{p}{,}
  \PYG{n}{setup\PYGZus{}queries}\PYG{p}{:} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,}
  \PYG{n}{storage}\PYG{p}{:} \PYG{p}{\PYGZob{}}
    \PYG{n}{datadir}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{./var}\PYG{l+s+s1}{\PYGZsq{}}
  \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{n}{engines}\PYG{p}{:} \PYG{p}{[}
    \PYG{p}{\PYGZob{}} \PYG{n}{label}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prestocluster1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
      \PYG{n}{executer}\PYG{p}{:} \PYG{p}{\PYGZob{}}
        \PYG{n}{name}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{presto}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{host}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{172.31.134.225}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{port}\PYG{p}{:} \PYG{l+m+mi}{9001}\PYG{p}{,}
        \PYG{n}{user}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{admin}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{catalog}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{hive}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{support\PYGZus{}database}\PYG{p}{:} \PYG{n}{true}\PYG{p}{,}
        \PYG{n}{default\PYGZus{}database}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{test}\PYG{l+s+s1}{\PYGZsq{}}
      \PYG{p}{\PYGZcb{}}\PYG{p}{,}
      \PYG{n}{monitor}\PYG{p}{:} \PYG{n}{null}
    \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{]}\PYG{p}{,}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}
\end{sphinxVerbatim}


\subsubsection{shib运行}
\label{\detokenize{installation/webui:id9}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{npm} \PYG{n}{start}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{presto-shib}.png}


\subsection{hue webUI}
\label{\detokenize{installation/webui:hue-webui}}
Hue是cdh专门的一套web管理器，它包括3个部分hue ui，hue server，hue db。hue提供所有的cdh组件的shell界面的接口。你可以在hue编写mr，
查看修改hdfs的文件，管理hive的元数据，运行Sqoop，编写Oozie工作流等大量工作。详情查看: \sphinxurl{https://docs.gethue.com/}。

hue暂时不支持查询presto，但是可以通过以下方式使其支持查询。


\subsubsection{Kubernetes}
\label{\detokenize{installation/webui:kubernetes}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{helm} \PYG{n}{repo} \PYG{n}{add} \PYG{n}{gethue} \PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{helm}\PYG{o}{.}\PYG{n}{gethue}\PYG{o}{.}\PYG{n}{com}
\PYG{n}{helm} \PYG{n}{repo} \PYG{n}{update}
\PYG{n}{helm} \PYG{n}{install} \PYG{n}{gethue}\PYG{o}{/}\PYG{n}{hue}
\end{sphinxVerbatim}


\subsubsection{docker安装}
\label{\detokenize{installation/webui:docker}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{docker} \PYG{n}{run} \PYG{o}{\PYGZhy{}}\PYG{n}{it} \PYG{o}{\PYGZhy{}}\PYG{n}{p} \PYG{l+m+mi}{8888}\PYG{p}{:}\PYG{l+m+mi}{8888} \PYG{n}{gethue}\PYG{o}{/}\PYG{n}{hue}\PYG{p}{:}\PYG{n}{latest}
\end{sphinxVerbatim}


\chapter{presto 使用}
\label{\detokenize{usercase:presto}}\label{\detokenize{usercase::doc}}
Presto is a distributed SQL query engine designed to query large data sets distributed over one or more heterogeneous data sources.


\chapter{presto核心设计}
\label{\detokenize{core:presto}}\label{\detokenize{core::doc}}
Presto is a distributed SQL query engine designed to query large data sets distributed over one or more heterogeneous data sources.


\chapter{presto之connector}
\label{\detokenize{connector:prestoconnector}}\label{\detokenize{connector::doc}}
Presto is a distributed SQL query engine designed to query large data sets distributed over one or more heterogeneous data sources.


\chapter{presto之sql}
\label{\detokenize{sql:prestosql}}\label{\detokenize{sql::doc}}

\chapter{presto函数}
\label{\detokenize{functions:presto}}\label{\detokenize{functions::doc}}

\chapter{presto数据类型}
\label{\detokenize{datatypes:presto}}\label{\detokenize{datatypes::doc}}

\chapter{presto之spi开发}
\label{\detokenize{spi:prestospi}}\label{\detokenize{spi::doc}}

\chapter{presto优化}
\label{\detokenize{optimize:presto}}\label{\detokenize{optimize::doc}}

\section{合理设置分区}
\label{\detokenize{optimize/partition:id1}}\label{\detokenize{optimize/partition::doc}}
spark提交job之后会把job分成多个stage，多个stage之间是有依赖关系的，正如前面所看到的的，stage0依赖于stage1，因此构成了有向无环图DAG。而且stage中
的依赖分为窄依赖和宽依赖，窄依赖是一个worker节点的数据只能被一个worker使用，而宽依赖是一个worker节点的数据被多个worker使用。一般讲多个窄依赖归
类为一个stage，方便与pipeline管道执行，而将以宽依赖分为一个stage。


\chapter{presto常见问题}
\label{\detokenize{faq:presto}}\label{\detokenize{faq::doc}}

\section{task exceeded max memory}
\label{\detokenize{faq/memory:task-exceeded-max-memory}}\label{\detokenize{faq/memory::doc}}


\renewcommand{\indexname}{索引}
\printindex
\end{document}